## HTTP ##

HTTP(HyperText Transfer Protocol)是一套计算机通过网络进行通信的规则。计算机专家设计出HTTP，使HTTP客户（如Web浏览器）能够从HTTP服务器(Web服务器)请求信息和服务，HTTP目前协议的版本是1.1.HTTP是一种无状态的协议，无状态是指Web浏览器和Web服务器之间不需要建立持久的连接，这意味着当一个客户端向服务器端发出请求，然后Web服务器返回响应(response)，连接就被关闭了，在服务器端不保留连接的有关信息.HTTP遵循请求(Request)/应答(Response)模型。Web浏览器向Web服务器发送请求，Web服务器处理请求并返回适当的应答。所有HTTP连接都被构造成一套请求和应答。

HTTP使用内容类型，是指Web服务器向Web浏览器返回的文件都有与之相关的类型。所有这些类型在MIME　Internet邮件协议上模型化，即Web服务器告诉Web浏览器该文件所具有的种类，是HTML文档、GIF格式图像、声音文件还是独立的应用程序。大多数Web浏览器都拥有一系列的可配置的辅助应用程序，它们告诉浏览器应该如何处理Web服务器发送过来的各种内容类型。


### 特点 ###

- 支持客户/服务器模式。支持基本认证和安全认证
- 简单快速：客户向服务器请求服务时，只需传送请求方法和路径。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。
- 灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。
- 无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。

##### 无状态和Connection：keep-alive区别 #####

- 无状态
    指协议对于事务处理没有记忆能力，服务器不知道客户端是什么状态。打开服务器上的网页和你之前打开这个服务器上的网页之间没有任何联系

- Connection：Keep-Alive
    HTTP/1.1起，默认都开启了Keep-Alive，保持连接特性，简单地说，当一个网页打开完成后，客户端和服务器之间用于传输HTTP数据的TCP连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。并且Keep-Alive不会永久保持连接，它有一个保持时间，可以在不同的服务器软件（如Apache）中设定这个时间，此时如果要判断传输是否结束不能通过返回-1来判断可通过响应头的Content-lenght数据长度判断是否接收完成。

### 请求 ###

##### 请求格式如下 #####

- 请求行 例如：GET /images/logo.jpg HTTP/1.1
- 消息报头(请求头) 例如： Accept-Language:zh，Content-Type：application/x-www-form-urlencoded等头信息。
- 空行（必须不可少的）
- 请求正文（可选消息体）

结构如下图示

![](http://images.cnitblog.com/i/116165/201407/121712545823346.png)

##### 请求方法 #####
HTTP/1.1协议中共定义了八种方法（有时也叫“动作”）有 OPTIONS，HEAD，GET ，POST ，PUT ，DELETE ，TRACE，CONNECT ，PATCH 。

我们来分析对比客户端常用2个方法 GET与POST，其他有兴趣自行了解。

##### GET与POST区别 #####
1. GET提交的数据会放在URL之后，以?分割URL和传输数据，参数之间以&相连，而POST方法是把提交的数据放在HTTP包的Body中。
2. GET提交的数据大小有限制，最多只能有1024字节（因为浏览器对URL的长度有限制），而POST方法提交的数据没有限制。
3. GET方式提交数据，会带来安全问题，比如一个登录页面，通过GET方式提交数据时，用户名和密码将出现在URL上，如果页面可以被缓存或者其他人可以访问这台机器，就可以从历史记录获得该用户的账号和密码。
4. GET方式需要使用Request.QueryString来取得变量的值，而POST方式通过Request.Form来获取变量的值。

### 响应 ###
服务器以一个状态行作为响应，响应的内容包括：消息协议的版本、成功或者错误编码、服务器信息、实体元信息以及必要的实体内容。根据响应类别的类别，服务器响应里可以含实体内容，但不是所有的响应都有实体内容。

##### 响应格式如下 #####
- 状态行,也就是响应头的第一行(First Line)例如：HTTP/1.1 200 OK
- 响应头消息(Respone Header) 例如Content-Type:text/html 等等一些头信息。
- 响应正文(Body)

结构如下图所示
![](http://images.cnitblog.com/i/116165/201407/121720098646366.png)

### HTTP无状态问题 ###
- 通过**Cookies**
    >通过Cookies，服务器就可以清楚的知道请求2和请求1来自同一个客户端。
    >![](http://images.cnitblog.com/i/116165/201407/122123269892896.png)

- 通过Session保存状态信息 
Session机制是一种服务器端的机制，服务器使用一种类似于散列表的结构（也可能就是使用散列表）来保存信息。
当程序需要为某个客户端的请求创建一个session的时候，服务器首先检查这个客户端的请求里是否已包含了一个session标识 - 称为 session id，如果已包含一个session id则说明以前已经为此客户端创建过session，服务器就按照session id把这个 session检索出来使用（如果检索不到，可能会新建一个），如果客户端请求不包含session id，则为此客户端创建一个session并且生成一个与此session相关联的session id，session id的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个session id将被在本次响应中返回给客户端保存。

    - 使用Cookies来实现
    > 服务器给每个Session分配一个唯一的JSESSIONID，并通过Cookie发送给客户端。
    当客户端发起新的请求的时候，将在Cookie头中携带这个JSESSIONID。这样服务器能够找到这个客户端对应的Session。 
    - 使用URL回写实现
    > URL回写是指服务器在发送给浏览器页面的所有链接中都携带JSESSIONID的参数，这样客户端点击任何一个链接都会把JSESSIONID带会服务器。如果直接在浏览器输入服务端资源的url来请求该资源，那么Session是匹配不到的。

- Cookie和Session区别
    - Cookie将状态保存在客户端，Session将状态保存在服务器端。
    - Cookies是服务器在本地机器上存储的小段文本并随每一个请求发送至同一个服务器。
    - Session是针对每一个用户的，变量的值保存在服务器上，用一个sessionID来区分是哪个用户session变量,这个值是通过用户的浏览器在访问的时候返回给服务器，当客户禁用cookie时，这个值也可能设置为由get来返回给服务器。
    - 就安全性来说，当你访问一个使用session 的站点，同时在自己机子上建立一个cookie，建议在服务器端的SESSION机制更安全些。因为它不会任意读取客户存储的信息。

### 一次完整的HTTP请求过程 ###

##### 建立TCP连接（三次握手）#####

在HTTP工作前Web浏览器首先要通过网络与Web服务器建立连接是通过TCP来完成的，该协议与IP协议共同构建了Intenet即TCP/IP协议簇。HTTP是比TCP更高层的协议只有底层协议建立连接后才能进行高层协议，端口号默认是80

##### 客户端请求 #####

   1. 一旦建立了TCP连接后，Web浏览器就向服务器发送请求命令。命令例如：GET/directory/Index.php HTTP/1.1
   2. 向Web服务器发送请求头信息，之后浏览器发送了一空白行来通知服务器，它已经结束了该头信息的发送（请求头信息）。
  
##### Web服务器应答 #####  
   1. 客户机向服务器发出请求后，服务器会客户机回送应答，HTTP/1.1 200 OK 应答的第一部分是协议的版本号和应答状态码
   2. 正如客户端会随同请求发送关于自身的信息一样，服务器也会随同应答向用户发送关于它自己的数据及被请求的文档（相应头信息）。Web服务器向浏览器发送头信息后，它会发送一个空白行来表示头信息的发送到此为结束，接着，它就以Content-Type应答头信息所描述的格式发送用户所请求的实际数据。
 
##### Web服务器关闭TCP连接 #####

一般情况下，一旦Web服务器向浏览器发送了请求数据，它就要关闭TCP连接，然后如果浏览器或者服务器在其头信息加入了这行代码Connection:keep-alive TCP连接在发送后将仍然保持打开状态，于是，浏览器可以继续通过相同的连接发送请求。保持连接节省了为每个请求建立新连接所需的时间，还节约了网络带宽。


## HTTPS ##

### 原理 ###
HTTPS（全称：Hypertext Transfer Protocol over Secure Socket Layer），是以安全为目标的HTTP通道，简单讲是HTTP的安全版。即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容请看SSL，HTTPS的端口号为443。
![](http://images.cnitblog.com/i/116165/201407/111703047392802.png)

### 加密算法类型 ###
##### 对称加密 #####

- 对称加密：密钥只有一个，加密解密为同一个密码，且加解密速度快，典型的对称加密算法有DES、AES等

##### 非对称加密 #####

- 非对称加密：密钥成对出现（且根据公钥无法推知私钥，根据私钥也无法推知公钥），加密解密使用不同密钥（公钥加密需要私钥解密，私钥加密需要公钥解密），相对对称加密速度较慢，典型的非对称加密算法有RSA、DSA等。

### 通信过程 ###
![](http://i.imgur.com/xBZogTB.png)

### HTTPS通信优点 ###
- 客户端产生的密钥只有客户端和服务器端能得到。
- 加密的数据只有客户端和服务器端才能得到明文。
- 客户端到服务端的通信是安全的。

### SSL/TLS加密 ###
- SSL/TLS原理 [http://mini.eastday.com/mobile/170814110419946.html](http://mini.eastday.com/mobile/170814110419946.html "SSL/TLS原理")